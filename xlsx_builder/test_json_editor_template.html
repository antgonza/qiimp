<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Proof-of-Concept Interface for Schema Definition</title>

    <!-- Bootstrap -->
    <link href= {{ static_url("css/bootstrap.min.css") }} rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <meta charset="utf-8" />

    <script src= {{ static_url("jsoneditor.min.js") }}  ></script>
  </head>
  <body>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src= {{ static_url("js/bootstrap.min.js") }} ></script>
    <h1>Proof-of-Concept Interface For Schema Definition</h1>

    <div id='editor_holder'></div>

    <script>
      // Initialize the editor
      var editor = new JSONEditor(document.getElementById('editor_holder'),{
        // Enable fetching schemas via ajax
        ajax: true,

        // The schema for the editor
        schema: {
  "title": "Metadata Fields",
  "type": "array",
  "format": "table",
  "items": {
    "title": "Metadata Field",
    "$ref": "#/definitions/name"
  }
},

        // Disable additional properties
        no_additional_properties: true,

        // Require all properties by default
        required_by_default: true,

        disable_edit_json: true,

        disable_properties: true,

        disable_collapse: true,

        theme: "bootstrap2"
      });

      // Hook up the submit button to log to the console
      //document.getElementById('submit').addEventListener('click',function() {
        // Get the value from the editor
        //console.log(editor.getValue());
      //});

      // Hook up the validation indicator to update its
      // status whenever the editor changes
      editor.on('change',function() {
        // Get an array of errors from the validator
        var errors = editor.validate();

        var indicator = document.getElementById('valid_indicator');

        // Not valid
        if(errors.length) {
          indicator.style.color = 'red';
          indicator.textContent = "invalid";
          document.getElementById("submit").disabled = true;
        }
        // Valid
        else {
          indicator.style.color = 'green';
          indicator.textContent = "valid";

          var json = editor.getValue();
          document.getElementById("schema_json").value = JSON.stringify(json,null,2);
          document.getElementById("submit").disabled = false;
        }
      });
    </script>
    <span id='valid_indicator'></span>
    <form method="post" action="">
      <input type="hidden" name="schema_json" id="schema_json">
      <input type="submit" id = "submit">
    </form>
  </body>
</html>